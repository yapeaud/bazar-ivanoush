#!/usr/bin/env bash

boilerplate=$( command -v boilerplate.sh ) \
  && . "$boilerplate" && unset boilerplate \
  || { echo "fatal: could not locate boilerplate.sh" && exit 1; }
boilerplate "$@";

process.use 'strict';
require.once 'assert';

# let assert(3) know if this test
# is being run standalone or as
# part of a task-test(7) test suite
assert.parse "$@";

lockfile() {
  # switch on lock file usage - singleton process
  process.lock.use!;
  # assert that we have a lock file
  process.lock.file;
  assert.file.exists? "$_result";
  process.lock?;
  assert.eq "0" "$?";
  
  # switch off lock file usage
  process.lock.use! off;
  # assert that the lock file does not exist
  process.lock.file;
  assert.file.exists! "$_result";
  
  assert.summary;
}
lockfile "$@";
